<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Producto — GN_amoblamientos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- NAVBAR (igual a index) -->
  <nav class="bg-white nav-shadow sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 lg:px-8 h-14 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <a href="./index.html" class="font-heading font-semibold text-lg tracking-slight text-gray-900" aria-label="GN_amoblamientos, ir al inicio">
          GN_amoblamientos
        </a>
      </div>
      <ul class="hidden md:flex items-center gap-6 font-heading text-sm tracking-slight text-gray-800">
        <li><a class="hover:underline underline-offset-4" href="./index.html#inicio">Inicio</a></li>
        <li><a class="hover:underline underline-offset-4" href="./index.html#productos">Productos</a></li>
        <li><a class="hover:underline underline-offset-4 text-red-600" href="./index.html#sale">Sale!</a></li>
        <li><a class="hover:underline underline-offset-4" href="./index.html#contacto">Contacto</a></li>
      </ul>
      <div class="flex items-center gap-3">
        <button class="p-2 relative" aria-label="Abrir carrito" title="Carrito" onclick="toggleCarrito()">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="currentColor"><path d="M3 3h2l2.4 10.3a2 2 0 0 0 2 1.7h6.3a2 2 0 0 0 2-1.7L20 7H6"/><circle cx="9" cy="19" r="1.3"/><circle cx="17" cy="19" r="1.3"/></svg>
          <span id="cart-count" class="absolute -top-1 -right-1 text-[10px] bg-black text-white rounded-full px-1.5 py-0.5 leading-none">0</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 lg:px-8 py-8">
    <a href="./index.html#productos" class="text-sm underline underline-offset-4">← Volver a productos</a>

    <div id="product-detail" class="grid grid-cols-1 lg:grid-cols-2 gap-10 mt-6">
      <!-- izquierda: imagen -->
      <div>
        <img id="pd-img" src="" alt="" class="w-full h-[420px] object-contain bg-white" />
        <div id="pd-thumbs" class="mt-3 flex gap-2"></div>
      </div>
      <!-- derecha: info -->
      <section>
        <h1 id="pd-name" class="font-heading text-2xl md:text-3xl tracking-slight text-gray-900 underline underline-offset-4"></h1>
        <div class="mt-3 flex items-end gap-3">
          <span id="pd-price" class="text-3xl font-bold text-black"></span>
          <span id="pd-old" class="text-base text-gray-400 line-through hidden"></span>
        </div>
        <p class="text-sm text-gray-500 mt-1">con transf/dep. · <span id="pd-cuotas"></span></p>

        <p id="pd-desc" class="mt-6 text-gray-700"></p>

        <div class="mt-6 grid grid-cols-2 gap-3 max-w-sm">
          <button id="btn-add" class="bg-black text-white py-2">Agregar al carrito</button>
          <button id="btn-whatsapp" class="border py-2">Consultar por WhatsApp</button>
        </div>

        <ul class="mt-8 text-sm text-gray-600 space-y-1">
          <li>• Fabricación nacional</li>
          <li>• Garantía 12 meses</li>
          <li>• Retiro en tienda o envío</li>
        </ul>
      </section>
    </div>
  
  <section class="max-w-7xl mx-auto px-4 lg:px-8 mt-12">
    <h2 class="font-heading text-lg tracking-slight mb-4">Productos relacionados</h2>
    <div id="relacionados" class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
  </section>

</main>

  <!-- MODAL CARRITO (compartido) -->
  <div id="modal-carrito" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50" role="dialog" aria-modal="true" aria-labelledby="titulo-carrito">
    <div class="bg-white rounded-2xl p-6 w-full max-w-lg relative shadow-2xl">
      <button onclick="toggleCarrito()" class="absolute top-3 right-4 text-2xl" aria-label="Cerrar">✖</button>
      <h2 id="titulo-carrito" class="text-2xl font-heading font-bold mb-4">Tu carrito</h2>
      <ul id="lista-carrito" class="mb-4 space-y-3 max-h-72 overflow-auto pr-1" aria-live="polite"></ul>
      <div class="flex items-center justify-between border-t pt-4 mb-4">
        <span class="text-lg font-medium">Subtotal</span>
        <span id="subtotal" class="text-xl font-bold">$0</span>
      </div>
      <div class="flex items-center justify-between gap-2">
        <button onclick="vaciarCarrito()" class="px-4 py-2 rounded border w-1/3">Vaciar</button>
        <button onclick="checkoutWhatsApp()" class="bg-green-600 text-white px-4 py-2 rounded w-2/3">Finalizar por WhatsApp</button>
      </div>
    </div>
  </div>

  <footer class="bg-white py-10 px-4 lg:px-8 border-t text-center">
    <p class="text-sm text-gray-500">© GN_amoblamientos</p>
  </footer>

  <script src="./app.js"></script>
  <script>
    // Lee ?id= de la URL
    const params = new URLSearchParams(location.search);
    const id = Number(params.get("id"));
    const { productos, agregarAlCarrito, fmt, getRelated } = window.__GN__;

    const p = productos.find(x => x.id === id);
    if (!p) {
      document.getElementById("product-detail").innerHTML = '<p class="text-gray-600">Producto no encontrado.</p>';
    } else {
      document.getElementById("pd-img").src = p.imagen;
      document.getElementById("pd-img").alt = p.nombre;
      document.getElementById("pd-name").textContent = p.nombre;
      document.getElementById("pd-price").textContent = fmt(p.precio);
      document.getElementById("pd-cuotas").textContent = p.cuotas || "";
      document.getElementById("pd-desc").textContent = p.descripcion || "";

      if (p.oldPrecio && p.oldPrecio > p.precio) {
        const old = document.getElementById("pd-old");
        old.classList.remove("hidden");
        old.textContent = fmt(p.oldPrecio);
      }

      document.getElementById("btn-add").addEventListener("click", () => agregarAlCarrito(p.id));

    // Render miniaturas (galería)
    const thumbs = document.getElementById("pd-thumbs");
    if (p.galeria && p.galeria.length) {
      p.galeria.forEach((src, i) => {
        const b = document.createElement("button");
        b.className = "w-16 h-16 border border-gray-200 bg-white flex items-center justify-center";
        b.setAttribute("aria-label", "Ver imagen " + (i+1));
        b.innerHTML = `<img src="${src}" alt="" class="max-w-full max-h-full object-contain" />`;
        b.addEventListener("click", () => {
          document.getElementById("pd-img").src = src;
        });
        thumbs.appendChild(b);
      });
    }

    // Render relacionados
    const rel = getRelated(p.categoria, p.id, 4);
    const relWrap = document.getElementById("relacionados");
    if (relWrap) {
      relWrap.innerHTML = rel.map(r => `
        <article class="card group relative p-4 md:p-5" tabindex="0">
          <a href="product.html?id=${r.id}" class="block">
            <img src="${r.imagen}" alt="${r.nombre}" class="w-full h-56 md:h-64 object-contain mx-auto" />
            <h3 class="font-heading tracking-slight text-sm md:text-base text-gray-900 mt-3 underline underline-offset-4">${r.nombre}</h3>
            <div class="mt-1 flex items-end gap-2">
              <span class="text-xl md:text-2xl font-bold text-black">${fmt(r.precio)}</span>
            </div>
            <p class="text-[12px] text-gray-500 mt-1">con transf/dep. · ${r.cuotas || ""}</p>
          </a>
          <div class="cta mt-4">
            <button class="w-full bg-black text-white text-sm py-2" data-add="${r.id}" aria-label="Agregar ${r.nombre} al carrito">Agregar al carrito</button>
          </div>
        </article>
      `).join("");

      relWrap.querySelectorAll("[data-add]").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const id = Number(e.currentTarget.getAttribute("data-add"));
          agregarAlCarrito(id);
          e.currentTarget.textContent = "Agregado ✓";
          setTimeout(()=> e.currentTarget.textContent = "Agregar al carrito", 900);
        });
      });
    }

      document.getElementById("btn-whatsapp").addEventListener("click", () => {
        const msg = encodeURIComponent(`Hola, quiero consultar por: ${p.nombre} (${fmt(p.precio)})`);
        window.open(`https://wa.me/5492615524525?text=${msg}`, "_blank", "noopener");
      });
    }
  </script>
</body>
</html>
