<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Producto | GN_amoblamientos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --font-headings: "Montserrat","Inter",system-ui,-apple-system,Segoe UI,Roboto,sans-serif; --color-accent:#2563eb; }
    .font-heading { font-family: var(--font-headings); letter-spacing: .015em; }
    .nav-shadow { box-shadow: 0 1px 8px rgba(0,0,0,.04); }
    :focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- NAVBAR (mismo, con único carrito) -->
  <nav class="bg-white nav-shadow sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 lg:px-8 h-14 grid grid-cols-3 items-center">
      <div class="flex items-center">
        <a href="index.html" class="font-heading font-semibold text-lg text-gray-900" aria-label="GN_amoblamientos, ir al inicio">
          GN_amoblamientos
        </a>
      </div>
      <ul class="hidden md:flex items-center justify-center gap-6 font-heading text-sm text-gray-800" role="menubar" aria-label="Navegación principal">
        <li role="none"><a role="menuitem" class="hover:underline underline-offset-4" href="index.html#inicio">Inicio</a></li>
        <li role="none"><a role="menuitem" class="hover:underline underline-offset-4" href="index.html#productos">Productos</a></li>
        <li role="none"><a role="menuitem" class="hover:underline underline-offset-4" href="index.html#contacto">Contacto</a></li>
      </ul>
      <div class="flex items-center justify-end">
        <button class="p-2 relative" aria-label="Abrir carrito" title="Carrito" onclick="toggleCarrito()">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" stroke="currentColor"><path d="M3 3h2l2.4 10.3a2 2 0 0 0 2 1.7h6.3a2 2 0 0 0 2-1.7L20 7H6"/><circle cx="9" cy="19" r="1.3"/><circle cx="17" cy="19" r="1.3"/></svg>
          <span id="cart-count" class="absolute -top-1 -right-1 text-[10px] bg-black text-white rounded-full px-1.5 py-0.5 leading-none">0</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO DETALLE -->
  <main class="max-w-7xl mx-auto px-4 lg:px-8 my-10">
    <a href="index.html#productos" class="text-sm underline underline-offset-4 hover:opacity-80">&larr; Volver</a>

    <section id="detalle" class="mt-6 grid gap-8 md:grid-cols-2 items-start">
      <!-- Imagen -->
      <div>
        <img id="p-imagen" src="" alt="" class="w-full h-[320px] md:h-[460px] object-cover rounded" />
      </div>
      <!-- Info -->
      <div>
        <h1 id="p-titulo" class="font-heading text-2xl md:text-3xl font-bold text-gray-900"></h1>
        <p id="p-categoria" class="text-sm text-gray-500 mt-1"></p>
        <div class="mt-3 text-3xl font-bold" id="p-precio">$0</div>
        <p id="p-desc" class="mt-4 text-gray-700 leading-relaxed"></p>

        <div class="mt-6 flex gap-3">
          <button id="btn-add" class="bg-black text-white px-4 py-2 rounded font-medium">Agregar al carrito</button>
          <a id="btn-wa" class="px-4 py-2 rounded border font-medium" target="_blank" rel="noopener">Consultar por WhatsApp</a>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL CARRITO (mismo que index) -->
  <div id="modal-carrito" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50" role="dialog" aria-modal="true" aria-labelledby="titulo-carrito">
    <div class="bg-white rounded-2xl p-6 w-full max-w-lg relative shadow-2xl">
      <button onclick="toggleCarrito()" class="absolute top-3 right-4 text-2xl" aria-label="Cerrar">✖</button>
      <h2 id="titulo-carrito" class="text-2xl font-heading font-bold mb-4">Tu carrito</h2>
      <ul id="lista-carrito" class="mb-4 space-y-3 max-h-72 overflow-auto pr-1" aria-live="polite"></ul>
      <div class="flex items-center justify-between border-t pt-4 mb-4">
        <span class="text-lg font-medium">Subtotal</span>
        <span id="subtotal" class="text-xl font-bold">$0</span>
      </div>
      <div class="flex items-center justify-between gap-2">
        <button onclick="vaciarCarrito()" class="px-4 py-2 rounded border w-1/3">Vaciar</button>
        <button onclick="checkoutWhatsApp()" class="bg-green-600 text-white px-4 py-2 rounded w-2/3">Finalizar por WhatsApp</button>
      </div>
    </div>
  </div>

  <script>
    // Mismo dataset que en index (ID/propiedades deben coincidir)
    const productos = [
      { id: 1,  nombre: "Biblioteca Nórdica 5 Estantes", precio: 129990, categoria: "Bibliotecas", imagen: "https://picsum.photos/seed/biblio/800/600", desc: "Diseño escandinavo, 5 estantes regulables." },
      { id: 2,  nombre: "Mesa Ratona Roble",             precio:  89990, categoria: "Mesas",       imagen: "https://picsum.photos/seed/mesa/800/600",    desc: "Tapa de roble natural, estructura firme." },
      { id: 3,  nombre: "Silla Minimal Tapizada",        precio:  59990, categoria: "Sillas",      imagen: "https://picsum.photos/seed/silla/800/600",   desc: "Tapizado lavable y patas de madera." },
      { id: 4,  nombre: "Rack TV 180 cm",                precio: 149990, categoria: "Racks",       imagen: "https://picsum.photos/seed/rack/800/600",    desc: "Amplio espacio para equipos y consolas." },
      { id: 5,  nombre: "Placard 3 Puertas",             precio: 199990, categoria: "Placares",    imagen: "https://picsum.photos/seed/placard/800/600", desc: "Gran capacidad, correderas metálicas." },
      { id: 6,  nombre: "Escritorio Compact",            precio: 109990, categoria: "Escritorios", imagen: "https://picsum.photos/seed/escritorio/800/600", desc: "Ideal para home office en espacios reducidos." },
      { id: 7,  nombre: "Mesa de Luz Duo",               precio:  49990, categoria: "Mesas",       imagen: "https://picsum.photos/seed/mesaluz/800/600", desc: "Doble cajón, correderas suaves." },
      { id: 8,  nombre: "Aparador Vintage",              precio: 139990, categoria: "Aparadores",  imagen: "https://picsum.photos/seed/aparador/800/600", desc: "Estética retro con gran capacidad." },
      { id: 9,  nombre: "Banqueta Alta",                 precio:  39990, categoria: "Sillas",      imagen: "https://picsum.photos/seed/banqueta/800/600", desc: "Estructura metálica y asiento confortable." },
    ];

    // ======== Carrito (compartido) ========
    const CART_KEY = "carrito_v2";
    let carrito = JSON.parse(localStorage.getItem(CART_KEY)) || [];
    const fmt = (n) => n.toLocaleString("es-AR", { style: "currency", currency: "ARS", maximumFractionDigits: 0 });
    const $  = (sel) => document.querySelector(sel);

    function cartQtyTotal(){ return carrito.reduce((a, it) => a + it.qty, 0); }
    function saveCart(){
      localStorage.setItem(CART_KEY, JSON.stringify(carrito));
      const cartCountNav = $("#cart-count");
      if (cartCountNav) cartCountNav.textContent = cartQtyTotal();
    }
    function agregarAlCarrito(id){
      const idx = carrito.findIndex(it => it.id === id);
      if (idx >= 0) carrito[idx].qty += 1; else carrito.push({ id, qty: 1 });
      saveCart(); renderCarrito();
    }
    function restarDelCarrito(id){
      const idx = carrito.findIndex(it => it.id === id);
      if (idx >= 0){ carrito[idx].qty -= 1; if (carrito[idx].qty <= 0) carrito.splice(idx,1); saveCart(); renderCarrito(); }
    }
    function eliminarDelCarrito(id){ carrito = carrito.filter(it => it.id !== id); saveCart(); renderCarrito(); }
    function vaciarCarrito(){ carrito = []; saveCart(); renderCarrito(); }
    function toggleCarrito(){ $("#modal-carrito").classList.toggle("hidden"); renderCarrito(); }

    function renderCarrito(){
      const lista = $("#lista-carrito"); if (!lista) return;
      lista.innerHTML = ""; let subtotal = 0;
      if (carrito.length === 0){ lista.innerHTML = `<li class="text-gray-500">Tu carrito está vacío.</li>`; }
      else {
        carrito.forEach(item=>{
          const p = productos.find(x=>x.id===item.id); if (!p) return;
          const totalLinea = p.precio * item.qty; subtotal += totalLinea;
          const el = document.createElement("li");
          el.className = "flex items-center justify-between gap-2";
          el.innerHTML = `
            <div class="flex items-center gap-3">
              <img src="${p.imagen}" alt="${p.nombre}" class="w-14 h-14 object-cover rounded">
              <div><p class="font-medium">${p.nombre}</p><p class="text-sm text-gray-500">${fmt(p.precio)} c/u</p></div>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-2 py-1 border rounded" data-dec="${p.id}" aria-label="Restar uno">−</button>
              <span class="w-6 text-center">${item.qty}</span>
              <button class="px-2 py-1 border rounded" data-inc="${p.id}" aria-label="Sumar uno">+</button>
              <span class="w-20 text-right font-semibold">${fmt(totalLinea)}</span>
              <button class="text-red-600 ml-2" data-del="${p.id}" aria-label="Eliminar del carrito">Eliminar</button>
            </div>`;
          lista.appendChild(el);
        });
      }
      $("#subtotal").textContent = fmt(subtotal);
      lista.querySelectorAll("[data-inc]").forEach(b=>b.addEventListener("click", e=>agregarAlCarrito(Number(e.currentTarget.getAttribute("data-inc")))));
      lista.querySelectorAll("[data-dec]").forEach(b=>b.addEventListener("click", e=>restarDelCarrito(Number(e.currentTarget.getAttribute("data-dec")))));
      lista.querySelectorAll("[data-del]").forEach(b=>b.addEventListener("click", e=>eliminarDelCarrito(Number(e.currentTarget.getAttribute("data-del")))));
    }

    // ======== Cargar producto por ?id= ========
    function getId(){ const u = new URL(location.href); return Number(u.searchParams.get("id")); }
    function initDetalle(){
      const id = getId();
      const p = productos.find(x=>x.id===id);
      if (!p){
        $("#detalle").innerHTML = `<p class="text-center text-gray-600">Producto no encontrado.</p>`;
        return;
      }
      $("#p-imagen").src = p.imagen;
      $("#p-imagen").alt = p.nombre;
      $("#p-titulo").textContent = p.nombre;
      $("#p-categoria").textContent = p.categoria || "";
      $("#p-precio").textContent = fmt(p.precio);
      $("#p-desc").textContent = p.desc || "Producto de GN_amoblamientos.";

      $("#btn-add").addEventListener("click", ()=>agregarAlCarrito(p.id));
      const waText = encodeURIComponent(`Hola, me interesa "${p.nombre}" (${fmt(p.precio)}).`);
      $("#btn-wa").href = `https://wa.me/5492615524525?text=${waText}`;
    }

    // ======== Checkout WhatsApp (mismo que index) ========
    function checkoutWhatsApp(){
      if (carrito.length === 0){ alert("Tu carrito está vacío."); return; }
      const fmtAR = (n)=>n.toLocaleString("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:0});
      const lineas = carrito.map(it=>{
        const p = productos.find(x=>x.id===it.id);
        return `• ${p?.nombre || "Item"} x ${it.qty} = ${fmtAR((p?.precio||0)*it.qty)}`;
      }).join("%0A");
      const total = carrito.reduce((acc,it)=>{ const p = productos.find(x=>x.id===it.id); return acc + (p ? p.precio*it.qty : 0); },0);
      const msg = `Hola, me interesa realizar esta compra:%0A${lineas}%0A%0ATotal: ${encodeURIComponent(fmtAR(total))}%0A%0ADatos de contacto:`;
      window.open(`https://wa.me/5492615524525?text=${msg}`,"_blank","noopener");
    }

    // ======== INIT ========
    initDetalle();
    saveCart();
  </script>
</body>
</html>
